@import "themes/variables.less";
@import "themes/overrides.less";
@import "image_viewer.less";
@import "xray_modal.less";

:root {
    --header-height: 3.65rem;
    --toolbar-height: 58px;
    --touch-target-height: 44px;
    --code-size: 85%;
}

/** global **/
html { font-size: 16px; }

/* space for the top menu */
html { scroll-padding-top: var(--header-height); }
.ui.fixed.menu + .ui.banner { padding-top: var(--header-height); }

/* sticky footer */
body { display: flex; flex-direction: column; }
.ui.forced.menu { border-radius: 0 !important; margin-top: auto; margin-bottom: 0; white-space: pre-wrap; }

/* remove visible outlines on focused menu items */
.ui.pagination.menu a:focus, .ui.navigation.menu a:focus { outline: 0; }

/* top navigation menu */
nav.ui.top.navigation.menu {
    .item .icon {
        margin-right: 0.5em;
    }
    form input {
        border-width: 0 !important;
    }
}

/** menu **/
.ui.secondary.menu {
    margin-bottom: 0;
    .item {
        height: 2.5em;
        padding: .75em .50em;
        &:hover { .bg-hover(); }
        > a { color: inherit; }
    }
}

/** form with collapsible details/summary section **/
.ui.form {
    > details {
        clear: both;
        margin: 0 0 1em;

        input:not([type]), input[type="date"], input[type="datetime-local"],
        input[type="email"], input[type="file"], input[type="number"],
        input[type="password"], input[type="search"], input[type="tel"],
        input[type="text"], input[type="time"], input[type="url"],
        textarea {
            box-sizing: border-box;
        }
    }
}

/** documentation **/
.ui.documentation {
    code { .bg-accent-code(); padding: .2em .3em; font-size: 90%; line-height: normal; }
}

/** timeline **/
.ui.feed {
    .event {
        &.highlighted {
            .bg-primary-1();
            width: calc(100% + 1.0rem);
            margin: -0.5rem;
            padding: 0.5rem;
        }

        > .label {
            img { width: 2.5em; height: 2.5em; object-fit: cover; }
            /* overlapping profile icons */
            .front { display: block; position: relative; width: 1.875em; height: 1.875em; }
            img + img { .front(); margin: -1.85rem 0 0 0.95rem; }
        }

        > .content {
            /* account for the label */
            width: calc(100% - 3.75em);
            overflow-wrap: break-word;
            word-wrap: break-word;
            word-break: break-word;
            -ms-hyphens: auto;
            -moz-hyphens: auto;
            -webkit-hyphens: auto;
            hyphens: auto;

            > details {
                margin-top: 0.5em;
                > summary + * {
                    margin: 0.5em 0 0;
                }
            }

            .summary > .date {
                font-size: 1em;
                font-weight: 700;
                margin: 0;
            }
            .extra.text {
                max-width: unset;
                &.deleted {
                    opacity: 50%;
                }
            }
            .detail {
                a {
                    img { cursor: pointer !important; }
                    i.user { font-size: 1.5em; vertical-align: text-bottom; color: var(--text-secondary); }
                    img + i, i + i {
                        color: var(--semantic-primary);
                        position: relative;
                        left: -10px;
                        bottom: -10px;
                        width: 5px;
                    }
                }
            }
            .meta {
                &:empty { display: none; }
                /* actions (e.g. reply and delete) */
                > form { display: inline; }
            }

            /* tweak margin on figures */
            figure { margin: 1em auto; }

            /* style figcaptions */
            figcaption { text-align: center; font-style: italic; }

            /* other styles */
            code { .bg-accent-code(); padding: .2em .3em; font-size: var(--code-size); line-height: normal; }
            pre { .bg-accent-pre(); padding: .2em .4em; font-size: var(--code-size); overflow-x: auto; }
        }
    }

    /* threaded posts */
    .threaded.depth-1 { margin-left: 1rem !important; width: calc(100% - 1rem) !important; }
    .threaded.depth-2 { margin-left: 2rem !important; width: calc(100% - 2rem) !important; }
    .threaded.depth-3 { margin-left: 3rem !important; width: calc(100% - 3rem) !important; }
    .threaded.depth-4 { margin-left: 4rem !important; width: calc(100% - 4rem) !important; }
    .threaded.depth-5 { margin-left: 5rem !important; width: calc(100% - 5rem) !important; }
    .threaded.depth-6 { margin-left: 6rem !important; width: calc(100% - 6rem) !important; }
    .threaded.depth-7 { margin-left: 7rem !important; width: calc(100% - 7rem) !important; }
    .threaded.depth-8 { margin-left: 8rem !important; width: calc(100% - 8rem) !important; }
    .threaded.depth-9 { margin-left: 9rem !important; width: calc(100% - 9rem) !important; }

    /* media in posts
       - classes "ui" and "image" are added to every `img` tag during
         HTML sanitization, including tags present in the object
         content. therefore, these classes are reliably on every image
         in a post.
       - media in `.extra.text` are in the object content. this is
         true of both local and remote posts.
       - media in `.extra.media` are "thumbnail size" attachments.
       - media with the class "extra" are "full size" attachments.
    */
    .ui.image:not(.emoji) { object-fit: cover; cursor: zoom-in; }
    .extra.media img, .extra.media audio, .extra.media video {
        display: inline-block;
        object-fit: cover;
        vertical-align: middle;
        overflow: hidden;
        width: 95px;
        height: 95px;
    }
    > .event {
        .extra.text img.image, .extra.text audio.audio, .extra.text video.video { width: 100%; }
        img.extra.image, audio.extra.audio, video.extra.video { width: 100%; }
    }
    > .detailed.event {
        .extra.text img.image, .extra.text audio.audio, .extra.text video.video { height: auto; }
        img.extra.image, audio.extra.audio, video.extra.video { height: auto; }
    }
    @media screen and (max-width: 599px) {           /* phones */
        .extra.text img.image, .extra.text video.video { height: 200px; }
        img.extra.image, video.extra.video { height: 200px; }
    }
    @media screen and (min-width: 600px) {           /* tablets portrait & larger */
        .extra.text img.image, .extra.text video.video { height: 375px; }
        img.extra.image, video.extra.video { height: 375px; }
    }
    @media screen and (min-width: 900px) {           /* tablets landscape & larger */
    }
    @media screen and (min-width: 1200px) {          /* desktops & larger */
    }
    @media screen and (min-width: 1800px) {          /* wide desktops & larger */
    }
}

.ui.text.container .ui.stackable.secondary.menu {
    .mobile-menu-toggle, .menu-toggle-checkbox {
        display: none;
    }
    .menu-items {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        width: 100%;
    }
}

/** mobile improvements **/
@media screen and (max-width: 599px) {
    /* Navigation icon-only mode on mobile */
    nav.ui.top.navigation.menu {
        .ui.text.container {
            display: flex;

            justify-content: center;

            &:has(.item:first-child:last-of-type + .menu) {
                justify-content: flex-start;
            }

            > .item {
                display: flex;
                text-align: center;
                justify-content: inherit;
                flex: 25%;

                .text { display: none; }
                .icon { margin: 0; }
            }
        }
    }

    /* Collapsible secondary menu */
    .ui.text.container .ui.stackable.secondary.menu {
        margin-top: 1rem;
        margin-bottom: 1rem;
        font-size: 105%;
        position: relative;

        .mobile-menu-toggle {
            display: block !important;
            margin-bottom: 0.5rem;

            label {
                display: block;
                background-color: var(--semantic-primary);
                color: var(--text-primary-inverted);
                padding: 0.75rem 1rem;
                border-radius: 3px;
                cursor: pointer;
                position: relative;

                .label {
                    font-size: 70% !important;
                    margin-left: 0.75rem !important;
                }
            }
        }

        .menu-items {
            display: none !important;
            position: relative;
            background: var(--bg-primary);
            border-radius: 3px;
            box-shadow: 0 2px 4px var(--border-color);
            padding: 0.5rem 0;
            margin-top: -0.5rem;

            .item {
                font-size: initial;
                width: 100%;
                margin: 0px !important;
                padding: 0.5rem 1rem;
            }
        }

        .menu-toggle-checkbox:checked ~ .menu-items {
            display: block !important;
        }

        .menu-toggle-checkbox:checked ~ .mobile-menu-toggle label .label {
            display: none;
        }
    }

    /* Full-width mobile pagination */
    .ui.text.container .ui.secondary.pagination.menu {
        display: flex;
        flex-direction: row;
        font-size: 115%;

        .item {
            flex: 50%;

            .icon {
                width: 100%;
            }
        }
    }

    /* Enhanced mobile typography */
    .ui.feed .event > .content {
        font-size: 105%;
        line-height: 1.4;
    }

    /* Mobile-optimized spacing and touch targets */
    /* 44px is Apple's minimum touch target */
    .ui.feed .event {
        margin-bottom: 1.5rem;
    }

    .ui.secondary.menu {
        font-size: 110%;

        > .item {
            min-height: var(--touch-target-height);
        }
    }
}

/** thread page **/
.ui.thread.segments {
    margin-top: 1rem !important;
}

/** large actor partial **/
.ui.actor.segments {
    margin-top: 1rem !important; margin-bottom: 1rem;
    > .segment:first-child {
        min-height: 18rem;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        &.blocked {
            min-height: auto;
        }
    }
    > .segment:first-child .actor-icon-container {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        width: 7rem;
        height: 7rem;
    }
    > .segment:first-child .actor-icon-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        .bg-transparent();
        border-radius: 3.5rem;
        border: 3px solid var(--bg-primary);
    }
    > .segment:first-child .actor-type-overlay {
        position: absolute;
        bottom: 0;
        right: 0;
        left: auto !important;
        width: 2rem;
        height: 2rem;
        margin: 0 !important;
        padding: 0;
        background-color: var(--bg-primary);
        border-radius: 1rem;
        border: 2px solid var(--bg-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1rem;
        color: var(--text-primary);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    > .segment:first-child i {
        position: absolute;
        bottom: 1.5rem;
        left: 1.5rem;
        color: var(--text-secondary);
        line-height: 5rem;
        font-size: 5rem;
    }
    > .segment th {
        border-right: 1px solid var(--border-color);
        text-align: right;
        font-weight: normal;
        padding-right: 1ex;
        margin-right: 1ex;
    }
    > .segment td {
        text-align: left;
        font-weight: normal;
        padding-left: 1ex;
    }
    > .segment.footer {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-start;
        gap: 0.5em;
        .status {
            position: static;
            flex: 1 1 265px;
            text-align: right;
            margin-left: auto;
            font-size: smaller;
            .text-muted();
        }
    }
}

/** small actor partial **/
.ui.actor.card {
    > .content.placeholder {
        background-color: var(--bg-label);
    }
    > .content:first-child {
        position: relative;
        min-height: 8rem;
        background-position: center;
        background-repeat: no-repeat;
        background-size: cover;
        &.blocked {
            min-height: auto;
        }
    }
    > .content:first-child img {
        position: absolute;
        bottom: 1rem;
        left: 1rem;
        width: 4rem;
        height: 4rem;
        object-fit: cover;
        .bg-transparent();
        border-radius: 2rem;
        border: 2px solid var(--bg-primary);
    }
    > .content:first-child i {
        position: absolute;
        bottom: 1.5rem;
        left: 1.5rem;
        color: var(--text-secondary);
        line-height: 3rem;
        font-size: 3rem;
    }
}

/* thread analysis */
#thread_analysis .ui.list .content {
    width: calc(100% - 2em);
    padding-bottom: 0.5em;
    > .header {
        font-size: 90%;
    }
    > .description {
        color: var(--text-secondary);
        font-size: 90%;
    }
}

/* additional styling for text */
.small.text { font-size: 0.75em; }

/* missing styling for forms */
.ui.form { margin-bottom: 1rem; }
.ui.form:last-child { margin-bottom: 0; }
.ui.inline.form { display: inline-block; margin-bottom: 0; }

/* missing styling for button elements (vs input elements) */
/* used in sign out item in the menu */
.ui.input > button { border: 1px solid var(--border-color); }

/* additional button styles */
/* used in posts in the timeline */
.ui.iconic.button { background: var(--color-transparent) none !important; color: var(--text-secondary) !important; padding: 0; margin: 0; }
.ui.iconic.button:hover { color: var(--text-primary) !important; }
.ui.iconic.blue.button { color: var(--semantic-primary) !important; }
.ui.iconic.purple.button { color: var(--color-purple) !important; }

/* used on social actions */
.ui.accept.button { background: var(--semantic-affirmative) !important; color: var(--text-white) !important; }
.ui.reject.button { background: var(--semantic-negative) !important; color: var(--text-white) !important; }
/* used on the timeline and elsewhere */
.ui.dangerous.button { color: var(--semantic-dangerous) !important; }
.ui.dangerous.button:hover { background-color: var(--semantic-dangerous-hover) !important; color: var(--text-white) !important; transition: 0.2s color ease; }
.ui.dangerous.iconic.button { background-color: var(--color-transparent) !important; color: var(--text-secondary) !important; }
.ui.dangerous.iconic.button:hover { color: var(--semantic-dangerous) !important; transition: 0.2s color ease; }

/* additional styling for modals */
.ui.modal > .header > i { margin-right: 1.0rem; }

/* additional styling for grids */
.ui.compact.grid > .column:not(.row) { padding-top: 0.25rem; padding-bottom: 0.25rem; }

/* mini toggle checkbox styling */
.ui.mini.toggle.checkbox {
    line-height: 12px;
    min-height: 1rem;
    input {
        width: 2.05rem; height: 1.0rem;
        &:checked {
            ~ label {
                &::after { left: 1.15rem; }
            }
        }
    }
    label {
        font-size: 80%; font-weight: bold; color: var(--text-secondary); padding-left: 2.5rem; min-height: 1.0rem; cursor: pointer;
        &:hover { color: var(--text-primary) !important; }
        &::before { width: 2.0rem; height: 1.0rem; }
        &::after { width: 1.0rem; height: 1.0rem; }
    }
}

/** trix toolbar **/
trix-toolbar {
    position: sticky; top: var(--toolbar-height); padding: 0 5px; z-index: 1;
    .trix-toolbar-container {
        white-space: normal !important; margin-bottom: 1em; display: flex; flex-wrap: wrap; gap: 0.30em 0.25em;
        button { border: none !important; padding: 0.75em !important; }
    }
}

/** trix editor **/
trix-editor {
    code { .bg-accent-code(); padding: .2em .3em; font-size: var(--code-size); line-height: normal; }
    pre { .bg-accent-pre(); padding: .2em .4em; font-size: var(--code-size); overflow-x: auto; }

    /* fix style conflicts with semantic ui */
    .attachment__caption-editor { padding: 0 !important; border: none !important; resize: unset !important; height: unset !important; min-height: unset !important; max-height: unset !important; }
    .attachment__caption { text-align: center; }

    figure img { object-fit: cover; width: 100%; height: auto; }
}

@media (scripting: none) {
    trix-editor {
        display: none;
    }
}

@media (scripting: enabled) {
    trix-editor + textarea {
        display: none;
    }
}

/** transitions **/

/* transitional elements */
.transitional {
    animation: fade-in 0.5s;
}

@keyframes fade-in {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

/* modals */
.ui.dimmer > .ui.modal {
    display: block;
    transition: all .3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    transform: scale(0.85);
    opacity: 0.0;
}

.ui.dimmer > .ui.modal.active {
    transform: scale(1.0);
    opacity: 1.0;
}

/** offline banner **/
.ui.banner .message {
  text-align: center;
  background-color: var(--color-yellow);
  display: none;
}

body.offline .ui.banner .message {
  display: block !important;
}

/** filter terms **/
.ui.filter.term > .wildcard {
    background-color: var(--bg-label);
    padding: 0 0.2em;
    margin: 0 0.1em;
}

/** colors **/
.blue { color: var(--semantic-primary); } // logging levels page

/** from mastodon **/
.invisible {
    font-size: 0;
    line-height: 0;
    display: inline-block;
    width: 0;
    height: 0;
}

.truncated {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    width: 100%;
}

.ellipsis::after {
    content: "…";
}

/** custom emoji **/
.ui.feed > .event > .content .summary img.emoji,
.ui.feed > .event > .content .extra.text img.emoji,
.ui.actor.segments img.emoji,
.ui.actor.card img.emoji {
    height: 1.0em;
    width: auto;
    max-width: 3.0em;
    margin: 0 0.05em 0 0.1em;
    vertical-align: -0.15em;
    display: inline-block;
    object-fit: contain;
    cursor: default;
}

/** design system **/
.design-system-section {
    margin: 2rem 0;
    padding: 1.5rem;
    .border-color-1();
    border-width: 1px;
    border-style: solid;
    border-radius: 4px;
    h2 {
        margin-top: 0;
        padding-bottom: 0.5rem;
        .border-color-2();
        border-bottom-width: 2px;
        border-bottom-style: solid;
        .text-primary-1();
    }
    h3 {
        margin-top: 1.5rem;
        .text-primary-2();
    }
    .component-showcase {
        margin: 1rem 0;
        padding: 1rem;
        border-radius: 3px;
        h4 {
            margin-top: 0;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            .text-primary-3();
        }
        .variation-group {
            margin: 1rem 0;
            .variation-label {
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
                font-weight: bold;
                .text-muted();
            }
        }
    }
}

.content .float-right {
    float: right;
}

/** polls **/
.ui.segment.poll {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    .bg-primary-1();
    /* poll -> vote transition */
    transition: opacity 0.25s ease, filter 0.25s ease;
    &[busy] {
        opacity: 0.5;
        filter: blur(2px);
    }
    &[complete] {
        opacity: 1.0;
        filter: blur(0);
    }
    .poll-vote-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    .poll-options {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        &:not(.disabled) {
            .poll-option label {
                cursor: pointer;
            }
        }
    }
    .poll-option {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        label {
            display: flex;
            input[type="checkbox"], input[type="radio"] {
                flex-shrink: 0;
                margin: 0 0.75em 0 0.5em;
            }
            .option-name {
                font-weight: 700;
            }
        }
        .poll-option-votes {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9em;
            height: 1.2em;
            gap: 0.5rem;
            .poll-count {
                min-width: 3ch;
                text-align: right;
            }
            .poll-option-bar {
                flex: 1;
                background-color: var(--bg-label);
                border-radius: 4px;
                overflow: hidden;
                height: 8px;
                .poll-option-bar-fill {
                    background-color: var(--semantic-primary);
                    height: 100%;
                }
            }
        }
    }
    .poll-footer {
        font-size: 0.9em;
        color: var(--text-secondary);
        button {
            margin-right: 0.5em;
        }
        .poll-status.active {
            color: var(--semantic-primary);
        }
        .poll-status.expired {
            color: var(--text-secondary);
            font-style: italic;
        }
        .poll-voters, .poll-type, .poll-closed-time {
            color: var(--text-secondary);
        }
        span + span::before {
            content: " • ";
        }
    }
}
